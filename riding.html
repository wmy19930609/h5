<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Riding</title>
    <meta charset="utf-8">

    <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
    <meta content=always name=referrer>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">

    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="date=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="telephone=no" name="format-detection">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">

    <link rel="shortcut icon" href="http://s3.qhimg.com/static/c56696ff943031e3.ico" type="image/x-icon" />

    <script src="./rem.js"></script>
    <link rel="stylesheet" href="./riding.css">
</head>
<body>
    <div id="wrapper">
        <!--<div class="page page1"><div class="kids"></div></div>-->
        <!--<div class="page page2">
            <img class="intro-img" src="http://p0.qhimg.com/t0127620ecbb018d5c9.png">
            <div class="kids"></div>
            <span class="backward"></span>
            <img src="http://p2.qhimg.com/t01b5db5a0733c7c13b.png">
        </div>-->
        <div class="page page3">
            <img class="bg-img" src="http://p9.qhimg.com/t011edde7418d364e79.png">
            <div class="city-popup"></div>
        </div>
    </div>

    <script src="http://s6.qhimg.com/static/88422eda07b71a23/m/libs/zepto.js"></script>

    <script>
        function flipOver(){
            var $page2 = $('#wrapper .page2');
            var startX, startY, changeX, changeY;
            var y = $('#wrapper').height();
            $page2.on('touchstart', function(e){
                startY = e.targetTouches[0].pageY;
            });

            $page2.on('touchend', function(e){
                changeY = e.changedTouches[0].pageY;
                if(changeY - startY < 0){
                    $page2.css({
                        '-webkit-transform' : 'translate3d(0px, -' + y + 'px, 0px);',
                        'transform' : 'translate3d(0px, -' + y + 'px, 0px);'
                    }).addClass('anim');
                }
            });
        }
        
        function ajax(req){
            $.ajax({
                url: req.url,
                data: req.data,
                dataType: 'jsonp',
                callback: req.cbk,
                method: 'POST',
                success: req.success,
                fail: req.fail
            })
        }
        
        function drawCity(){
            var cityList = ['zjk', 'zy', 'ts', 'yc', 'kkth', 'wlmq', 'kksl', 'kns', 'klmy', 'sw', 'tklmg', 'xzx'];
            var dom = '';
            cityList.forEach(function(city){
                dom += '<div class="'+ city +' city">' +
                        '<img class="city-icon" src="./img/'+ city +'.png" />' +
                            '<img class="'+ city +'-pop popup" src="./img/'+ city +'-pop.png" />' +
                        '</div>';
            });
            $('.city-popup').append(dom)
        }
        drawCity()
        function init(){
            flipOver();
            $('.js-follow').on('click', function(){
                var $this = $(this)
                ajax({
                    url: 'http://record.btime.com/sub',
                    data: { 'c_id':  307831},
                    callback: 'follow',
                    success: function(res){
                        if(res.errno == 0 && res.data.length){
                            $this.addClass('not')
                        }
                    },
                    fail: function(err){
                        console.log(err)
                    }
                });
            });

            $('.js-vote').on('click', function(){
                var $this = $(this)
                ajax({
                    url: ' http://voteapi.btime.com/v2/poll/results',
                    data: { 'subjId':  2345, 'id': 6067, 'depMd5': '889675bcbdc82c50260173446d19d4bd'},
                    method: 'POST',
                    callback: 'vote',
                    success: function(res){
                        alert(1)
                        console.log(res)
                    },
                    fail: function(err){
                        console.log(err)
                    }
                });
            });
        }

        init()
    </script>
</body>
</html>